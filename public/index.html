<!DOCTYPE html>
<html>

<head>
    <title>红色警戒2图标生成器</title>
    <meta charset="UTF-8" />
    <link rel="icon" href="favicon.ico">
    <link rel="preload" href="IPix.ttf" as="font" type="font/ttf" crossorigin>
    <link rel="preload" href="ra2/bg.png" as="image">
    <link rel="preload" href="ra2/button.png" as="image">
    <link rel="preload" href="ra2/button_c.png" as="image">
    <link rel="preload" href="ra2/75pxbtn.png" as="image">
    <link rel="preload" href="ra2/75pxbtn_c.png" as="image">
    <link rel="preload" href="ra2/unchecked.png" as="image">
    <link rel="preload" href="ra2/checked.png" as="image">
    <link rel="preload" href="ra2/modal.png" as="image">
    <link rel="preload" href="cameo_lighter.png" as="image">
    <link rel="preload" href="cameo_outer.png" as="image">
    <link rel="preload" href="raiting_sign.png" as="image">
    <link rel="preload" href="ready_text.png" as="image">
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-font-smoothing: none;
            font-smooth: never;
            -webkit-text-size-adjust: none;
            text-size-adjust: none;
            transform: scale(1);
            font-variation-settings: none;
            /* text-rendering: geometricPrecision; */
            transform: scale(1);
        }

        #ViewCanvas {
            image-rendering: pixelated;
            width: 150px;
            height: 120px;
            position: absolute;
            right: 8px;
            top: 35px;
        }

        .workspace {
            position: absolute;
            width: 632px;
            height: 568px;
            left: 0;
            top: 0;
            background-color: transparent;
            background-image: none;
            padding-left: 30px;
            padding-top: 30px;
        }

        @font-face {
            font-family: 'IPix';
            src: url('IPix.ttf') format('truetype');
            /* font-display: swap; */
            font-weight: normal;
            font-style: normal;
        }

        :root {
            --ra2-text-color: #ffff00;
            --ra2-disabled-color: #4a0000;
            --mo-text-color: #ffffff;
            --mo-disabled-color: #250025;
        }

        body {
            margin: 0;
            padding: 0;
            height: 100vh;
            width: 100vw;
            display: flex;
            justify-content: center;
            align-items: center;
            background: #000000;
            font-family: 'IPix', sans-serif;
            color: var(--ra2-text-color);
            font-size: 16px;
            min-width: 800px;
            min-height: 600px;
        }

        .mo-style body {
            color: var(--mo-text-color);
        }

        p {
            user-select: none;
        }

        .page-title {
            font-size: 16px;
            box-sizing: border-box;
            position: absolute;
            width: 166px;
            height: 20px;
            text-align: center;
            right: 0;
            top: 4px;
            user-select: none;
            font-weight: normal;
        }

        .mo-style .page-title {
            color: var(--mo-text-color);
        }

        .center-box {
            width: 800px;
            height: 600px;
            position: relative;
            border: 0;
            background-image: url('ra2/bg.png');
            background-size: cover;
            background-repeat: no-repeat;
        }

        .center-box.mo-style {
            background-image: url('mo/bg.png');
        }

        .button-column {
            position: absolute;
            left: 645px;
            top: 198px;
            display: flex;
            flex-direction: column;
            gap: 0;
        }

        .btn_r {
            width: 144px;
            height: 42px;
            border: none;
            cursor: pointer;
            font-family: 'IPix', sans-serif;
            color: var(--ra2-text-color);
            font-size: 16px;
            background-image: url('ra2/button.png');
            background-size: cover;
            line-height: 42px;
            text-align: center;
        }

        .mo-style .btn_r {
            background-image: url('mo/button.png');
            color: var(--mo-text-color);
        }

        .btn_r:active {
            background-image: url('ra2/button_c.png');
            transform: translateY(1px);
        }

        .mo-style .btn_r:active {
            background-image: url('mo/button_c.png');
        }

        .btn_r:disabled {
            cursor: default;
            color: var(--ra2-disabled-color);
        }

        .mo-style .btn_r:disabled {
            cursor: default;
            color: var(--mo-disabled-color);
        }

        .btn_r:disabled:active {
            background-image: url('ra2/button.png');
            transform: none;
        }

        .mo-style .btn_r:disabled:active {
            background-image: url('mo/button.png');
            transform: none;
        }

        /* @supports (font-variation-settings: normal) {
            body {
                font-family: 'IPix', sans-serif;
            }
        } */

        textarea {
            background-color: #000000;
            border: 2px solid #ff0000;
            color: var(--ra2-text-color);
            font-family: 'IPix', monospace;
            padding: 10px;
            font-size: 16px;
            margin-bottom: 4px;
        }

        .mo-style textarea {
            color: var(--mo-text-color);
            border: 2px solid #800080;
        }

        textarea:focus::placeholder {
            color: transparent;
        }


        input[type="checkbox"] {
            opacity: 0;
            position: absolute;
        }


        input[type="checkbox"]+label {
            position: relative;
            padding-left: 30px;
            color: var(--ra2-text-color);
            cursor: pointer;
            vertical-align: middle;
        }

        .mo-style input[type="checkbox"]+label {
            color: var(--mo-text-color);
        }


        input[type="checkbox"]+label::before {
            content: "";
            display: inline-block;
            width: 20px;
            height: 20px;
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            background: url(ra2/unchecked.png) no-repeat;

            background-size: contain;
        }

        .mo-style input[type="checkbox"]+label::before {
            background-image: url(mo/unchecked.png);
        }


        input[type="checkbox"]:checked+label::before {
            background-image: url(ra2/checked.png);

        }

        .mo-style input[type="checkbox"]:checked+label::before {
            background-image: url(mo/checked.png);
        }

        #IconImage {
            opacity: 0;
            position: absolute;
            z-index: -1;
        }

        .mo-style .mo-style {
            color: var(--mo-text-color);
        }

        .ra2cameo-common-button {
            width: 75px;
            height: 23px;
            border: none;

            display: inline-flex;
            justify-content: center;
            background-image: url('ra2/75pxbtn.png');
            background-size: cover;
            font-family: 'IPix', sans-serif;
            color: var(--ra2-text-color);
            font-size: 16px;
            line-height: 23px;

            cursor: pointer;
        }

        .mo-style .ra2cameo-common-button {
            background-image: url('mo/75pxbtn.png');
            color: var(--mo-text-color);
        }


        .ra2cameo-common-button:active {
            background-image: url('ra2/75pxbtn_c.png');
        }

        .mo-style .ra2cameo-common-button:active {
            background-image: url('mo/75pxbtn_c.png');
        }

        #ReadyTextColor {
            border: 1px solid #ff0000 !important;
            padding: 0 !important;
            background: transparent !important;
            box-sizing: border-box;
            overflow: hidden;
            vertical-align: middle;
            height: 20px;
        }

        .mo-style #ReadyTextColor {
            border: 1px solid #800080 !important;
            color: var(--mo-text-color);
        }

        #ReadyTextColor::-webkit-color-swatch {
            border: none !important;
            border-radius: 0;
        }

        #ReadyTextColor::-webkit-color-swatch-wrapper {
            padding: 0 !important;
        }

        #ReadyTextColor::-webkit-color-swatch {
            border: 1px solid #ff0000 !important;
            box-sizing: border-box;
        }

        .mo-style #ReadyTextColor::-webkit-color-swatch {
            border: 1px solid #800080 !important;
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            z-index: 1000;
        }

        .custom-modal {
            box-sizing: border-box;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-image: url('ra2/modal.png');
            padding: 20px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.2);
            height: 326px;
            width: 451px;
            display: none;
            background-size: cover;
            z-index: 1001;
            /* animation: slidein 0.3s ease; */
            border-radius: 10px;
            line-height: 20px;
            padding-left: 21px;
        }

        .mo-style .custom-modal {
            background-image: url('mo/modal.png');
        }

        .custom-modal p {
            margin-bottom: 12px;
        }

        .cancel-btn {
            position: absolute;
            right: 30px;
            bottom: 30px;
        }

        .label-item {
            line-height: 20px;
            margin-bottom: 12px;
        }

        a:link,
        a:visited,
        a:hover,
        a:active {
            color: var(--ra2-text-color) !important;
        }

        .mo-style a:link,
        .mo-style a:visited,
        .mo-style a:hover,
        .mo-style a:active {
            color: var(--mo-text-color) !important;
        }

        #fileName {
            color: var(--ra2-text-color);
        }

        .mo-style #fileName {
            color: var(--mo-text-color);
        }

        .label-item label[for="ReadyTextColor"] {
            color: var(--ra2-text-color);
        }

        .mo-style .label-item label[for="ReadyTextColor"] {
            color: var(--mo-text-color);
        }
    </style>
</head>

<body>

    <div class="modal-overlay" id="overlay"></div>

    <div class="custom-modal" id="modal">
        <p>网页加载需要时间，请等待网页加载完毕后再选择合适的图片生成图标以避免生成失败。如果觉得这个工具帮助到了您，希望可以在您的素材列表中引用本工具网址，谢谢。
        </p>
        <p>本工具仅供学习交流使用，不得用于商业用途，请勿生成任何违法违规内容！</p>
        <p>程序：<a href="https://www.bysb.net/">手柄</a>（<a href="https://www.bysb.net/donati">赞助</a>） | 界面：<a
                href="https://ra2cameo.geek-talk.cn">极客谈</a></p>
        <p>项目仓库：<a href="https://github.com/iamapig120/ra2-cameo-gen">GitHub</a></p>
        <p>本程序是非营利性的粉丝项目，与Electronic Arts Inc.没有任何关联。所有权利均由其各自所有者持有。</p>
        <button class="ra2cameo-common-button cancel-btn">确定</button>
    </div>
    </div>
    <div class="center-box">
        <h1 class="page-title">图标生成器</h1>
        <canvas id="ViewCanvas" height="48" width="60"></canvas>
        <!-- 工作区 -->
        <div class="workspace">

            <p class="label-item">
                <input type="checkbox" name="enable_full_eng_name" id="EnableFullEnglishName" /><label
                    for="EnableFullEnglishName">Full Enghlish Unit Name</label>
            </p>
            <p>
                <textarea name="unit_name_textarea" id="UnitName" cols="16" rows="4"
                    placeholder="单位名称&#10支持多行"></textarea>
            </p>
            <p class="label-item">
                <input type="checkbox" name="enable_rating_sign" id="EnableRatingSign" /><label
                    for="EnableRatingSign">显示升级图示</label>
            </p>
            <p class="label-item" id="EnableCameoColor_P">
                <input type="checkbox" name="enable_cameo_color" id="EnableCameoColor" /><label
                    for="EnableCameoColor">使用原版色盘</label>
            </p>
            <p class="label-item">
                <input type="checkbox" name="enable_ready_text" id="EnableReadyText" /><label
                    for="EnableReadyText">显示就绪文字</label>
            </p>

            <p class="label-item">
                <input type="checkbox" name="enable_mo" id="EnableMO" />
                <label for="EnableMO">启用心灵终结风格</label>
            </p>
            <p class="label-item">
                <input type="color" name="ready_text_color" id="ReadyTextColor" value="#FFFF00" />
                <label for="ReadyTextColor"> 就绪文字颜色</label>
            </p>
            <p class="label-item">
                <input type="file" name="icon_image" id="IconImage" accept="image/*"
                    onchange="document.getElementById('fileName').textContent = this.files[0].name" />
                <label for="IconImage" class="ra2cameo-common-button">选择文件
                </label>
                <span id="fileName"></span>
            </p>

        </div>

        <div class="button-column">
            <button type="button" class="btn_r" id="Redraw">绘制图像</button>
            <button type="button" class="btn_r" id="OutputAsPNG" disabled>导出PNG</button>
            <button type="button" class="btn_r" id="OutputAsSHP" disabled>导出SHP</button>
            <button type="button" class="btn_r" id="OutputAsPCX" disabled>导出256色PCX</button>
            <button type="button" class="btn_r" id="OutputAsPCX_FullColor" disabled>导出全彩PCX</button>

        </div>
    </div>


</body>


<script>
    const modal = document.getElementById('modal');
    const overlay = document.getElementById('overlay');
    const cancelBtn = modal.querySelector('.cancel-btn');
    function openModal() {
        overlay.style.display = 'block';
        modal.style.display = 'block';
        document.body.style.overflow = 'hidden';
    }


    function closeModal() {
        overlay.style.display = 'none';
        modal.style.display = 'none';
        document.body.style.overflow = 'auto';
    }

    document.addEventListener('DOMContentLoaded', () => {
        openModal();
        cancelBtn.addEventListener('click', closeModal);
    });
</script>
<script src="main.js"></script>
<script>
    function updateFileName() {
        const input = document.getElementById('IconImage');
        const fileName = document.getElementById('fileName');

        if (input.files.length > 1) {
            fileName.textContent = input.files.length + '个文件已选择';
        } else {
            fileName.textContent = input.files[0]?.name || '未选择文件';
        }
    }

    document.addEventListener('DOMContentLoaded', function () {
        updateFileName();
        document.getElementById('IconImage').addEventListener('change', updateFileName);
    });
</script>
<script>
    let moResourcesLoaded = false;

    function preloadMOResources() {
        if (moResourcesLoaded) return;

        const resources = [
            'mo/75pxbtn.png',
            'mo/75pxbtn_c.png',
            'mo/bg.png',
            'mo/button.png',
            'mo/button_c.png',
            'mo/checked.png',
            'mo/mnscrnl.png',
            'mo/modal.png',
            'mo/unchecked.png'
        ];

        resources.forEach(resource => {
            const img = new Image();
            img.src = resource;
        });

        moResourcesLoaded = true;
        console.log('MO resources preloaded');
    }

    function toggleMOStyle() {
        const enableMO = document.getElementById('EnableMO');
        const centerBox = document.querySelector('.center-box');

        if (enableMO.checked) {
            // 预加载MO资源（只在第一次点击时）
            if (!moResourcesLoaded) {
                preloadMOResources();
            }
            centerBox.classList.add('mo-style');
        } else {
            centerBox.classList.remove('mo-style');
        }
    }
    document.getElementById('EnableMO').addEventListener('change', toggleMOStyle);
</script>

</html>